<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Uso Web Storage con JSON</title>
	
	
</head>
<body>
	<form>
		<div>
			<label>Nombre:</label>
			<div><input type="text" /></div>
		</div>
		<div>
			<label>Apellidos:</label>
			<div><input type="text" /></div>
		</div>
		<div>
			<label>Email:</label>
			<div><input type="text" /></div><br>
			
		</div><br>
		<div>
			<div>
				<div><input type="button" value="Grabar" /></div><br>
			</div>
			<div>
				<div><input type="button" value="Recuperar" /><br/>
				<input type="button" value="Limpiar" /></div>
			</div>
		</div>
		
	</form>
	
<script>
document.addEventListener('readystatechange', inicializar, false );

if(localStorage.length<=0){
	var cont=0;
}else{
	var cont=localStorage.length;
}


function inicializar(){
	var botonGrabar=document.getElementsByTagName("input")[3];
	var botonRecuperar=document.getElementsByTagName("input")[4];
	var botonLimpiar=document.getElementsByTagName("input")[5];
	botonGrabar.addEventListener('click', accion, false);
	botonRecuperar.addEventListener('click', accion, false);
	botonLimpiar.addEventListener('click', accion, false);
	alert(cont);
}
function accion(evento){
	var nombre=document.getElementsByTagName("input")[0].value;
	var apellido=document.getElementsByTagName("input")[1].value;
	var mail=document.getElementsByTagName("input")[2].value;
	var contacto= { "Nombre": nombre, "Apellidos": apellido, "mail": mail};
	
	switch(evento.target.value){
		case 'Grabar':
		alert("Grabando");
		localStorage.setItem("contacto"+cont.toString(), JSON.stringify(contacto));
		document.getElementsByTagName("form")[0].reset();
		cont++;alert(cont);break;
		
		case 'Recuperar':
		alert("Recuperando");
		alert(cont);
		alert(localStorage.getItem("contacto"+cont.toString()));
		var datos=JSON.parse(localStorage.getItem("contacto"+(cont-1).toString()));
		document.getElementsByTagName("input")[0].value=datos.Nombre;
		document.getElementsByTagName("input")[1].value=datos.Apellidos;
		document.getElementsByTagName("input")[2].value=datos.mail;
		
		break;
		
		case 'Limpiar':
		alert("limpiando");
		localStorage.clear();
		cont=0;break;

	}
}
</script>
</body>
</html>